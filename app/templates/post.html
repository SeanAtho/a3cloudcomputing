{% extends "layout.html" %}
{% block title %}{{ post.author.username }}'s Post{% endblock %}

{% block content %}
<main class="post-detail">
    <article aria-label="Post Content">
        <header>
            <h2>{{ post.author.username }} says:</h2>
        </header>
        <p>{{ post.body }}</p>
        <time datetime="{{ post.timestamp.isoformat() }}">{{ post.timestamp.strftime('%b %d, %Y at %H:%M') }}</time>
    </article>

    <!-- Dropzone Form for File Uploads -->
    <section class="file-upload">
        <h3>Upload Related Files</h3>
        <form action="{{ url_for('upload', post_id=post.id) }}" class="dropzone" id="post-file-dropzone">
            <!-- Dropzone will automatically append file input fields here -->
        </form>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.0/min/dropzone.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.0/min/dropzone.min.js"></script>
        <script>
        Dropzone.options.postFileDropzone = {
            paramName: "file", // The name that will be used to transfer the file
            maxFilesize: 2, // MB
            acceptedFiles: "image/*, .pdf",
            dictDefaultMessage: "Drag files here or click to upload",
        };
        </script>
    </section>

    <!-- Comments Section -->
    <aside aria-label="Comments Section">
        <h3>Comments:</h3>
        {% if comments %}
            <ul class="comments-list">
                {% for comment in comments %}
                    <li>
                        <strong>{{ comment.author.username }}</strong> commented:
                        <p>{{ comment.body }}</p>
                        <time datetime="{{ comment.timestamp.isoformat() }}">{{ comment.timestamp.strftime('%b %d, %Y at %H:%M') }}</time>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No comments yet. Be the first to comment!</p>
        {% endif %}
        {% if current_user.is_authenticated %}
            <h4>Add a comment:</h4>
            <form action="{{ url_for('comment', post_id=post.id) }}" method="post">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{ form.body.label(class="form-control-label") }}
                    {{ form.body(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.submit(class="btn btn-primary") }}
                </div>
            </form>
        {% else %}
            <p><a href="{{ url_for('main.login') }}">Log in</a> to add a comment.</p>
        {% endif %}
    </aside>
</main>
{% endblock %}
